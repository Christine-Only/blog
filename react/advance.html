<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <meta name="referrer" content="no-referrer"><link rel="icon" href="/growth.jpg"><title>React è¿›é˜¶ | Christine</title><meta name="description" content="ä¸€åä¸“æ³¨å‰ç«¯å¼€å‘çš„ç¨‹åºåª› ğŸ‘§ğŸ»">
    <link rel="preload" href="/blog/assets/style-C08YezIb.css" as="style"><link rel="stylesheet" href="/blog/assets/style-C08YezIb.css">
    <link rel="modulepreload" href="/blog/assets/app-C8Xn24jF.js"><link rel="modulepreload" href="/blog/assets/advance.html-BNDmdJjZ.js">
    <link rel="prefetch" href="/blog/assets/index.html-CM6jBVt3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C6L8a4fP.js" as="script"><link rel="prefetch" href="/blog/assets/nginx.html-Bq1Q3T_I.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Zm5FAoYh.js" as="script"><link rel="prefetch" href="/blog/assets/prettier.html-D_HkrdxC.js" as="script"><link rel="prefetch" href="/blog/assets/stylelint.html-DhohiZCV.js" as="script"><link rel="prefetch" href="/blog/assets/umi.html-bZ2Ph2P8.js" as="script"><link rel="prefetch" href="/blog/assets/FactoryPattern.html-DHfeVGHg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CTPzo7K8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUROa93m.js" as="script"><link rel="prefetch" href="/blog/assets/advance.html-C3pnkXlB.js" as="script"><link rel="prefetch" href="/blog/assets/browser.html-DK3VeRhs.js" as="script"><link rel="prefetch" href="/blog/assets/css.html-BKY3Mi15.js" as="script"><link rel="prefetch" href="/blog/assets/es6.html-B30rnm-v.js" as="script"><link rel="prefetch" href="/blog/assets/eventLoop.html-DE06P53X.js" as="script"><link rel="prefetch" href="/blog/assets/handWrite.html-DXp-hFnV.js" as="script"><link rel="prefetch" href="/blog/assets/html.html-Btx2VmlT.js" as="script"><link rel="prefetch" href="/blog/assets/http.html-XfsL6qRE.js" as="script"><link rel="prefetch" href="/blog/assets/jsAsync.html-CwhETaoP.js" as="script"><link rel="prefetch" href="/blog/assets/safetyProtection.html-CuqgWWQ-.js" as="script"><link rel="prefetch" href="/blog/assets/url.html-B2x9gcLO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CGjfw9oy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3iyfIuo.js" as="script"><link rel="prefetch" href="/blog/assets/antd.html-DMY_nhd6.js" as="script"><link rel="prefetch" href="/blog/assets/css.html-10ae-nYX.js" as="script"><link rel="prefetch" href="/blog/assets/nginx.html-JG3ijibO.js" as="script"><link rel="prefetch" href="/blog/assets/react.html-BiQaBfQe.js" as="script"><link rel="prefetch" href="/blog/assets/stylelint.html-CCkSQJPI.js" as="script"><link rel="prefetch" href="/blog/assets/vite.html-CAwYGphH.js" as="script"><link rel="prefetch" href="/blog/assets/vscode.html-CdcGrCOe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DzTjtE24.js" as="script"><link rel="prefetch" href="/blog/assets/RN.html-D5rs7Dss.js" as="script"><link rel="prefetch" href="/blog/assets/hooks.html-Bw9pzYbE.js" as="script"><link rel="prefetch" href="/blog/assets/reactInterview.html-DA-Ul4_k.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CkDHoN-f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CI8fM_cU.js" as="script"><link rel="prefetch" href="/blog/assets/advance.html-64RPqVTj.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-DGAYFaJ6.js" as="script"><link rel="prefetch" href="/blog/assets/challenge.html-D8x2q-a5.js" as="script"><link rel="prefetch" href="/blog/assets/challengeBuildIn.html-BiDzWy9o.js" as="script"><link rel="prefetch" href="/blog/assets/interview.html-DuiYON7c.js" as="script"><link rel="prefetch" href="/blog/assets/tsconfig.html-BEo61lHZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3xc3phrg.js" as="script"><link rel="prefetch" href="/blog/assets/network.html-DwYrVGXL.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-Opwmw_lf.js" as="script"><link rel="prefetch" href="/blog/assets/webOptimize.html-DkmLHRC3.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-CMg9haB1.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="logo" src="/blog/logo.png" alt="Christine"><span class="site-name can-hide" aria-hidden="true">Christine</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/blog/interview/" aria-label="å‰ç«¯é¢è¯•ä¹‹é“"><!--[--><!--[--><!--]--> å‰ç«¯é¢è¯•ä¹‹é“ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link route-link-active" href="/blog/react/" aria-label="React"><!--[--><!--[--><!--]--> React <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/webpack/" aria-label="webpack"><!--[--><!--[--><!--]--> webpack <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/typescript/" aria-label="TypeScript"><!--[--><!--[--><!--]--> TypeScript <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/tailwind-css/" aria-label="TailWind CSS"><!--[--><!--[--><!--]--> TailWind CSS <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/advance/prettier.html" aria-label="å‰ç«¯è¿›é˜¶"><!--[--><!--[--><!--]--> å‰ç«¯è¿›é˜¶ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/automate/" aria-label="å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²"><!--[--><!--[--><!--]--> å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½² <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/git/" aria-label="Git"><!--[--><!--[--><!--]--> Git <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/other/css.html" aria-label="è¸©è¿‡çš„å‘"><!--[--><!--[--><!--]--> è¸©è¿‡çš„å‘ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å‰ç«¯ä¹¦ç±"><span class="title">å‰ç«¯ä¹¦ç±</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å‰ç«¯ä¹¦ç±"><span class="title">å‰ç«¯ä¹¦ç±</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/blog/books/" aria-label="JavaScriptè®¾è®¡æ¨¡å¼"><!--[--><!--[--><!--]--> JavaScriptè®¾è®¡æ¨¡å¼ <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Christine-Only/blog" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/blog/interview/" aria-label="å‰ç«¯é¢è¯•ä¹‹é“"><!--[--><!--[--><!--]--> å‰ç«¯é¢è¯•ä¹‹é“ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link route-link-active" href="/blog/react/" aria-label="React"><!--[--><!--[--><!--]--> React <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/webpack/" aria-label="webpack"><!--[--><!--[--><!--]--> webpack <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/typescript/" aria-label="TypeScript"><!--[--><!--[--><!--]--> TypeScript <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/tailwind-css/" aria-label="TailWind CSS"><!--[--><!--[--><!--]--> TailWind CSS <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/advance/prettier.html" aria-label="å‰ç«¯è¿›é˜¶"><!--[--><!--[--><!--]--> å‰ç«¯è¿›é˜¶ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/automate/" aria-label="å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²"><!--[--><!--[--><!--]--> å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½² <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/git/" aria-label="Git"><!--[--><!--[--><!--]--> Git <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/blog/other/css.html" aria-label="è¸©è¿‡çš„å‘"><!--[--><!--[--><!--]--> è¸©è¿‡çš„å‘ <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å‰ç«¯ä¹¦ç±"><span class="title">å‰ç«¯ä¹¦ç±</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å‰ç«¯ä¹¦ç±"><span class="title">å‰ç«¯ä¹¦ç±</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/blog/books/" aria-label="JavaScriptè®¾è®¡æ¨¡å¼"><!--[--><!--[--><!--]--> JavaScriptè®¾è®¡æ¨¡å¼ <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/Christine-Only/blog" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">React <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link route-link-active sidebar-item" href="/blog/react/" aria-label="React åŸºç¡€"><!--[--><!--[--><!--]--> React åŸºç¡€ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active sidebar-item active" href="/blog/react/advance.html" aria-label="React è¿›é˜¶"><!--[--><!--[--><!--]--> React è¿›é˜¶ <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/#jsxåˆ°åº•æ˜¯ä»€ä¹ˆ" aria-label="JSXåˆ°åº•æ˜¯ä»€ä¹ˆ"><!--[--><!--[--><!--]--> JSXåˆ°åº•æ˜¯ä»€ä¹ˆ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#virtual-dom-å¦‚ä½•æå‡æ•ˆç‡" aria-label="Virtual DOM å¦‚ä½•æå‡æ•ˆç‡"><!--[--><!--[--><!--]--> Virtual DOM å¦‚ä½•æå‡æ•ˆç‡ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#è™šæ‹Ÿdomå®ç°åŸç†" aria-label="è™šæ‹ŸDOMå®ç°åŸç†"><!--[--><!--[--><!--]--> è™šæ‹ŸDOMå®ç°åŸç† <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/#jsx-å’Œ-createelement" aria-label="JSX å’Œ createElement"><!--[--><!--[--><!--]--> JSX å’Œ createElement <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#å…¨æ–°çš„-jsx-è½¬æ¢å™¨" aria-label="å…¨æ–°çš„ JSX è½¬æ¢å™¨"><!--[--><!--[--><!--]--> å…¨æ–°çš„ JSX è½¬æ¢å™¨ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#åˆ›å»ºè™šæ‹Ÿdom" aria-label="åˆ›å»ºè™šæ‹ŸDOM"><!--[--><!--[--><!--]--> åˆ›å»ºè™šæ‹ŸDOM <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="/blog/#fiber-èŠ‚ç‚¹çš„æ„å»º" aria-label="Fiber èŠ‚ç‚¹çš„æ„å»º"><!--[--><!--[--><!--]--> Fiber èŠ‚ç‚¹çš„æ„å»º <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/#render-é˜¶æ®µ" aria-label="render é˜¶æ®µ"><!--[--><!--[--><!--]--> render é˜¶æ®µ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#render-å®Œæˆ" aria-label="render å®Œæˆ"><!--[--><!--[--><!--]--> render å®Œæˆ <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="/blog/#react-diff" aria-label="React Diff"><!--[--><!--[--><!--]--> React Diff <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/#diff-çš„ç“¶é¢ˆä»¥åŠ-react-å¦‚ä½•åº”å¯¹" aria-label="Diff çš„ç“¶é¢ˆä»¥åŠ React å¦‚ä½•åº”å¯¹"><!--[--><!--[--><!--]--> Diff çš„ç“¶é¢ˆä»¥åŠ React å¦‚ä½•åº”å¯¹ <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="/blog/#åè°ƒç®—æ³•" aria-label="åè°ƒç®—æ³•"><!--[--><!--[--><!--]--> åè°ƒç®—æ³• <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/#å­¦ä¹ åšå®¢" aria-label="å­¦ä¹ åšå®¢"><!--[--><!--[--><!--]--> å­¦ä¹ åšå®¢ <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="/blog/react/hooks.html" aria-label="React Hooks"><!--[--><!--[--><!--]--> React Hooks <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/blog/react/reactInterview.html" aria-label="React é¢è¯•é¢˜"><!--[--><!--[--><!--]--> React é¢è¯•é¢˜ <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">React Native <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="/blog/react/RN.html" aria-label="RN"><!--[--><!--[--><!--]--> RN <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="react-è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#react-è¿›é˜¶"><span>React è¿›é˜¶</span></a></h1><h2 id="jsxåˆ°åº•æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#jsxåˆ°åº•æ˜¯ä»€ä¹ˆ"><span>JSXåˆ°åº•æ˜¯ä»€ä¹ˆ</span></a></h2><p>JSXä»£ç åœ¨æ‰§è¡Œå‰ï¼Œä¼šè¢«<code>Babel</code>è½¬æ¢ä¸º<code>React.createElement</code>æ–¹æ³•çš„è°ƒç”¨ï¼Œè¯¥æ–¹æ³•åœ¨è°ƒç”¨åä¼šè¿”å›<code>Virtual DOM</code>å¯¹è±¡ï¼Œç„¶åReactå†å°†<code>Virtual DOM</code>å¯¹è±¡è½¬æ¢ä¸ºçœŸå®çš„DOMå¯¹è±¡ï¼Œå†å°†çœŸå®DOMæ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚</p><h2 id="virtual-dom-å¦‚ä½•æå‡æ•ˆç‡" tabindex="-1"><a class="header-anchor" href="#virtual-dom-å¦‚ä½•æå‡æ•ˆç‡"><span>Virtual DOM å¦‚ä½•æå‡æ•ˆç‡</span></a></h2><p>ç²¾å‡†æ‰¾å‡ºå‘ç”Ÿå˜åŒ–çš„ DOM å¯¹è±¡ï¼Œåªæ›´æ–°å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ã€‚</p><p>åœ¨ React ç¬¬ä¸€æ¬¡åˆ›å»º DOM å¯¹è±¡åï¼Œä¼šä¸ºæ¯ä¸ª DOM å¯¹è±¡åˆ›å»ºå…¶å¯¹åº”çš„ Virtual DOM å¯¹è±¡ï¼Œåœ¨ DOM å¯¹è±¡å‘ç”Ÿæ›´æ–°ä¹‹å‰ï¼ŒReact ä¼šå…ˆæ›´æ–°æ‰€æœ‰çš„ Virtual DOM å¯¹è±¡ï¼Œç„¶å React ä¼šå°†æ›´æ–°åçš„ Virtual DOM å’Œ æ›´æ–°å‰çš„ Virtual DOM è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œæ‰¾å‡ºå‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ï¼ŒReact ä¼šå°†å‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†æ›´æ–°åˆ°çœŸå®çš„ DOM å¯¹è±¡ä¸­ï¼ŒReact ä»…æ›´æ–°å¿…è¦æ›´æ–°çš„éƒ¨åˆ†ã€‚</p><h2 id="è™šæ‹Ÿdomå®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿdomå®ç°åŸç†"><span>è™šæ‹ŸDOMå®ç°åŸç†</span></a></h2><p><img src="/blog/vdom.png" alt="alt"></p><p>æŒ‰ç…§å›¾ä¸­çš„æµç¨‹ï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥åˆ†æ<code>è™šæ‹ŸDOM</code>çš„å®ç°åŸç†ã€‚</p><h3 id="jsx-å’Œ-createelement" tabindex="-1"><a class="header-anchor" href="#jsx-å’Œ-createelement"><span>JSX å’Œ createElement</span></a></h3><p>æˆ‘ä»¬åœ¨å®ç°ä¸€ä¸ª<code>React</code>ç»„ä»¶æ—¶å¯ä»¥é€‰æ‹©ä¸¤ç§ç¼–ç æ–¹å¼</p><ul><li>ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨<code>JSX</code>ç¼–å†™ï¼š</li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello Christine</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¬¬äºŒç§æ˜¯ç›´æ¥ä½¿ç”¨<code>React.createElement</code>ç¼–å†™ï¼š</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello Christine</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…ä¸Šï¼Œä¸Šé¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œ<code>JSX</code>åªæ˜¯ä¸º <code>React.createElement(component, props, ...children)</code>æ–¹æ³•æä¾›çš„è¯­æ³•ç³–ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„<code>JSX</code>ä»£ç æœ€åéƒ½ä¼šè½¬æ¢æˆ<code>React.createElement(...)</code>ï¼Œ<code>Babel</code>å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†è¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚</p><p>å¦‚ä¸‹é¢çš„<code>JSX</code></p><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>profile<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Hello</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†ä¼šè¢«<code>Babel</code>è½¬æ¢ä¸º</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&quot;avatar.png&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">&quot;profile&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>Hello<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p><code>babel</code>åœ¨ç¼–è¯‘æ—¶ä¼šåˆ¤æ–­<code>JSX</code>ä¸­ç»„ä»¶çš„é¦–å­—æ¯ï¼Œå½“é¦–å­—æ¯ä¸ºå°å†™æ—¶ï¼Œå…¶è¢«è®¤å®šä¸ºåŸç”Ÿ<code>DOM</code>æ ‡ç­¾ï¼Œ<code>createElement</code>çš„ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¼–è¯‘ä¸ºå­—ç¬¦ä¸²ï¼›å½“é¦–å­—æ¯ä¸ºå¤§å†™æ—¶ï¼Œå…¶è¢«è®¤å®šä¸ºè‡ªå®šä¹‰ç»„ä»¶ï¼Œ<code>createElement</code>çš„ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¼–è¯‘ä¸ºå¯¹è±¡ï¼›</p></div><p>å¦å¤–ï¼Œç”±äº<code>JSX</code>æå‰è¦è¢«<code>Babel</code>ç¼–è¯‘ï¼Œæ‰€ä»¥<code>JSX</code>æ˜¯ä¸èƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ç±»å‹çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Story</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Wrong! JSX type can&#39;t be an expression.</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>components<span class="token punctuation">[</span>props<span class="token punctuation">.</span>storyType<span class="token punctuation">]</span> story<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>story<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦å˜æˆä¸‹é¢çš„å†™æ³•ï¼š</p><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">Story</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Correct! JSX type can be a capitalized variable.</span>
  <span class="token keyword">const</span> SpecificStory <span class="token operator">=</span> components<span class="token punctuation">[</span>props<span class="token punctuation">.</span>storyType<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SpecificStory</span></span> <span class="token attr-name">story</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>story<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼Œä½¿ç”¨<code>JSX</code>æ—¶ï¼Œéœ€è¦å®‰è£…<code>Babel</code>æ’ä»¶ï¼š</p><ul><li>@babel/core</li><li>@babel/preset-env</li><li>@babel/preset-react</li><li>babel-loader</li></ul><p>åœ¨ webpack é…ç½®æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä¸º JavaScript æ–‡ä»¶æ·»åŠ ä¸€ä¸ªè§„åˆ™ï¼Œè®© babel-loader å¯ä»¥è¿è¡Œã€‚é€šå¸¸åœ¨webpack.config.jsæ–‡ä»¶çš„module-&gt;rulesæ•°ç»„ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&#39;babel-loader&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;@babel/preset-env&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@babel/preset-react&#39;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºå’Œé…ç½® Babel çš„é…ç½®æ–‡ä»¶ï¼ˆ<code>.babelrc</code> æˆ– <code>babel.config.json</code>ï¼‰ ï¼Œ<code>@babel/preset-react</code> æ˜¯è´Ÿè´£å°† JSX è½¬æ¢ä¸º React.createElement çš„ presetã€‚</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@babel/preset-react&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…¨æ–°çš„-jsx-è½¬æ¢å™¨" tabindex="-1"><a class="header-anchor" href="#å…¨æ–°çš„-jsx-è½¬æ¢å™¨"><span>å…¨æ–°çš„ JSX è½¬æ¢å™¨</span></a></h3><p>æ€»ç»“ä¸‹æ¥å°±æ˜¯ä¸¤ç‚¹ï¼š</p><ul><li>ç”¨ jsx() å‡½æ•°æ›¿æ¢ React.createElement()</li><li>è¿è¡Œæ—¶è‡ªåŠ¨å¼•å…¥ jsx() å‡½æ•°ï¼Œæ— éœ€æ‰‹å†™å¼•å…¥react</li></ul><p>åœ¨<strong>v16</strong>ä¸­ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªReactç»„ä»¶ï¼Œæ€»è¦å¼•å…¥</p><div class="language-tsx line-numbers-mode" data-ext="tsx" data-title="tsx"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ˜¯å› ä¸ºåœ¨æµè§ˆå™¨ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨ jsxï¼Œæ‰€ä»¥è¦å€ŸåŠ©å·¥å…·å¦‚@babel/preset-reactå°† jsx è¯­æ³•è½¬æ¢ä¸º React.createElement çš„ js ä»£ç ï¼Œæ‰€ä»¥éœ€è¦æ˜¾å¼å¼•å…¥ Reactï¼Œæ‰èƒ½æ­£å¸¸è°ƒç”¨ createElementã€‚ v17ä¹‹åï¼ŒReact ä¸ Babel å®˜æ–¹è¿›è¡Œåˆä½œï¼Œç›´æ¥é€šè¿‡å°† react/jsx-runtime å¯¹ jsx è¯­æ³•è¿›è¡Œäº†æ–°çš„è½¬æ¢è€Œä¸ä¾èµ–</p><h3 id="åˆ›å»ºè™šæ‹Ÿdom" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºè™šæ‹Ÿdom"><span>åˆ›å»ºè™šæ‹ŸDOM</span></a></h3><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è™šæ‹Ÿ<code>DOM</code>çš„çœŸå®æ¨¡æ ·ï¼Œå°†ä¸‹é¢çš„<code>JSX</code>ä»£ç åœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼š</p><div class="language-jsx line-numbers-mode" data-ext="jsx" data-title="jsx"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Hello Christine</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">è‹¹æœ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">æ©˜å­</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/vdom2.jpg" alt="alt"></p><h2 id="fiber-èŠ‚ç‚¹çš„æ„å»º" tabindex="-1"><a class="header-anchor" href="#fiber-èŠ‚ç‚¹çš„æ„å»º"><span>Fiber èŠ‚ç‚¹çš„æ„å»º</span></a></h2><p>ä¸‹é¢çš„ä¼ªä»£ç å±•ç¤ºäº† <code>fiber</code> æ„å»ºçš„è¿‡ç¨‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">workLoop</span><span class="token punctuation">(</span><span class="token parameter">deadline</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// requestIdleCallback ç»™ shouldYield èµ‹å€¼ï¼Œå‘Šè¯‰æˆ‘ä»¬æµè§ˆå™¨æ˜¯å¦ç©ºé—²</span>
  <span class="token keyword">let</span> shouldYield <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextUnitOfWork <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shouldYield<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextUnitOfWork <span class="token operator">=</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span>nextUnitOfWork<span class="token punctuation">)</span>
    shouldYield <span class="token operator">=</span> deadline<span class="token punctuation">.</span><span class="token function">timeRemaining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¾ªç¯è°ƒç”¨ workLoop</span>
  <span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>workLoop<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">requestIdleCallback</span><span class="token punctuation">(</span>workLoop<span class="token punctuation">)</span>

<span class="token comment">// æ„å»ºå®Œå½“å‰ fiber èŠ‚ç‚¹åï¼Œä¼šè¿”å›ä¸‹ä¸€ä¸ªå¾…æ„å»ºçš„èŠ‚ç‚¹ å¦‚ï¼šfiber.siblingã€fiber.parent...</span>
<span class="token keyword">function</span> <span class="token function">performUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">nextUnitOfWork</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// TODO</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>deadline.timeRemaining()</code>çš„å€¼ä¸ºæµ®ç‚¹æ•°ï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰é—²ç½®å‘¨æœŸçš„é¢„ä¼°å‰©ä½™æ¯«ç§’æ•°ã€‚å¦‚æœé—²ç½®æœŸå·²ç»ç»“æŸï¼Œåˆ™å…¶å€¼ä¸º 0ã€‚</li><li><code>requestIdleCallback</code>æ–¹æ³•å¾ˆç®€å•ï¼šå®ƒéœ€è¦ä¼ å…¥ä¸€ä¸ª <code>callback</code>ï¼Œæµè§ˆå™¨ä¼šåœ¨ç©ºé—²æ—¶å»è°ƒç”¨è¿™ä¸ª <code>callback</code>ï¼Œç„¶åç»™è¿™ä¸ª <code>callback</code> ä¼ å…¥ä¸€ä¸ª <code>IdleDeadline</code>ï¼Œ<code>IdleDeadline</code> ä¼šé¢„ä¼°ä¸€ä¸ªå‰©ä½™é—²ç½®æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿˜å‰©å¤šå°‘é—²ç½®æ—¶é—´å»åˆ¤æ–­ï¼Œæ˜¯å¦è¶³å¤Ÿå»æ‰§è¡Œä¸‹ä¸€ä¸ªå•å…ƒä»»åŠ¡ã€‚</li><li><code>performUnitOfWork</code> æ–¹æ³•å°†ä¼ å…¥çš„èŠ‚ç‚¹åˆ›å»ºä¸º <code>Fiber</code> ï¼Œç„¶åè¿”å›ä¸‹ä¸€ä¸ªå¾…æ„å»ºçš„èŠ‚ç‚¹å¹¶èµ‹å€¼ç»™ <code>nextUnitOfWork</code>ï¼ŒåŒæ—¶è¿˜ä¼šå°†åˆšåˆ›å»ºçš„ <code>Fiber</code> ä¸å·²åˆ›å»ºçš„ <code>Fiber</code> è¿æ¥èµ·æ¥æ„æˆ Fiber æ ‘ã€‚</li></ul><h3 id="render-é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#render-é˜¶æ®µ"><span>render é˜¶æ®µ</span></a></h3><p><code>render</code> é˜¶æ®µçš„å¼€å§‹ï¼Œé¦–å…ˆä» <code>rootFiber</code> å¼€å§‹å‘ä¸‹<strong>æ·±åº¦ä¼˜å…ˆéå†</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸æ–­ <code>while</code> å¾ªç¯æ‰§è¡Œ <code>performUnitOfWork</code>ï¼Œä¼šç»å†<code>é€’</code>å’Œ<code>å½’</code>ä¸¤ä¸ªé˜¶æ®µã€‚</p><p><strong>â€œé€’â€é˜¶æ®µ</strong></p><ul><li>å‘ä¸‹éå†ï¼Œæ¯ä¸ªéå†åˆ°çš„ <code>Fiber</code> èŠ‚ç‚¹ä¼šè°ƒç”¨ <code>beginWork</code> æ–¹æ³•ã€‚</li><li>è¯¥æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„ <code>Fiber</code> èŠ‚ç‚¹åˆ›å»º <code>å­Fiber</code> èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸¤ä¸ª <code>Fiber</code> èŠ‚ç‚¹è¿æ¥èµ·æ¥ã€‚</li><li>å½“éå†åˆ°æ²¡æœ‰ <code>child</code> çš„èŠ‚ç‚¹æ—¶å°±ä¼šè¿›å…¥â€œå½’â€é˜¶æ®µã€‚</li></ul><p><strong>â€œå½’â€é˜¶æ®µ</strong></p><p>åœ¨â€œå½’â€é˜¶æ®µä¼šè°ƒç”¨ <code>completeWork</code> å¤„ç† <code>Fiber</code> èŠ‚ç‚¹ã€‚ å½“æŸä¸ª <code>Fiber</code> èŠ‚ç‚¹æ‰§è¡Œå®Œ <code>completeWork</code>ï¼Œå¦‚æœå…¶å­˜åœ¨å…„å¼Ÿ<code>Fiber</code>èŠ‚ç‚¹ï¼Œä¼šè¿›å…¥å…¶<strong>å…„å¼ŸFiber</strong>çš„â€œé€’â€é˜¶æ®µã€‚ å¦‚æœä¸å­˜åœ¨<strong>å…„å¼ŸFiber</strong>ï¼Œä¼šè¿›å…¥<strong>çˆ¶Fiber</strong>çš„â€œå½’â€é˜¶æ®µã€‚</p><h3 id="render-å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#render-å®Œæˆ"><span>render å®Œæˆ</span></a></h3><p>â€œé€’â€å’Œâ€œå½’â€é˜¶æ®µä¼šäº¤é”™æ‰§è¡Œç›´åˆ°â€œå½’â€åˆ° <code>rootFiber</code>ã€‚è‡³æ­¤ï¼Œ<code>render</code> é˜¶æ®µçš„å·¥ä½œå°±ç»“æŸäº†ã€‚</p><h2 id="react-diff" tabindex="-1"><a class="header-anchor" href="#react-diff"><span>React Diff</span></a></h2><p><code>diff ç®—æ³•</code>å‘ç”Ÿåœ¨ä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ <code>beginWork</code> å’Œ <code>completeWork</code> é˜¶æ®µã€‚</p><h3 id="diff-çš„ç“¶é¢ˆä»¥åŠ-react-å¦‚ä½•åº”å¯¹" tabindex="-1"><a class="header-anchor" href="#diff-çš„ç“¶é¢ˆä»¥åŠ-react-å¦‚ä½•åº”å¯¹"><span>Diff çš„ç“¶é¢ˆä»¥åŠ React å¦‚ä½•åº”å¯¹</span></a></h3><p>ç”±äº <code>Diff</code> æ“ä½œæœ¬èº«ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æŸè€—ï¼ŒReact æ–‡æ¡£ä¸­æåˆ°ï¼Œå³ä½¿åœ¨æœ€å‰æ²¿çš„ç®—æ³•ä¸­ï¼Œå°†å‰åä¸¤æ£µæ ‘å®Œå…¨æ¯”å¯¹çš„ç®—æ³•çš„å¤æ‚ç¨‹åº¦ä¸º O(n 3 )ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°é‡ã€‚ å¦‚æœåœ¨ React ä¸­ä½¿ç”¨äº†è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆå±•ç¤º 1000 ä¸ªå…ƒç´ æ‰€éœ€è¦æ‰§è¡Œçš„è®¡ç®—é‡å°†åœ¨åäº¿çš„é‡çº§èŒƒå›´ã€‚è¿™ä¸ªå¼€é”€å®åœ¨æ˜¯å¤ªè¿‡é«˜æ˜‚ã€‚ ä¸ºäº†é™ä½ç®—æ³•å¤æ‚åº¦ï¼ŒReact çš„ diff ä¼šé¢„è®¾ä¸‰ä¸ªé™åˆ¶ï¼š</p><ol><li>åªè¿›è¡Œ<code>åŒå±‚æ¯”è¾ƒ</code>ã€‚</li><li>æ–°ã€æ—§èŠ‚ç‚¹çš„ <code>type</code> ä¸åŒï¼Œç›´æ¥<code>åˆ é™¤</code>æ—§èŠ‚ç‚¹ï¼Œ<code>åˆ›å»º</code>æ–°èŠ‚ç‚¹ã€‚å¦‚ï¼šå…ƒç´ ç”± <code>div</code> å˜ä¸º <code>p</code>ï¼ŒReactä¼š<code>é”€æ¯</code>div<code>åŠå…¶å­å­™èŠ‚ç‚¹</code>ï¼Œ<code>å¹¶æ–°å»º</code> p <code>åŠå…¶å­å­™èŠ‚ç‚¹</code>ã€‚</li><li>é€šè¿‡ <code>key</code> æ¥<code>å¤ç”¨</code>èŠ‚ç‚¹ã€‚</li></ol><p><a href="https://juejin.cn/post/7212918899867041849#heading-0" target="_blank" rel="noopener noreferrer">ä¸€æ–‡è®²é€šReactçš„diffè¿‡ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="åè°ƒç®—æ³•" tabindex="-1"><a class="header-anchor" href="#åè°ƒç®—æ³•"><span>åè°ƒç®—æ³•</span></a></h2><p>Reactçš„åè°ƒç®—æ³•ï¼ˆä¹Ÿç§°ä½œReconciliationï¼‰æ˜¯ä¸€ç§é«˜æ•ˆåœ°æ¯”è¾ƒå’Œæ›´æ–°è™šæ‹ŸDOMæ ‘çš„ç®—æ³•ï¼Œå®ƒè§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯åœ¨å­˜åœ¨å¤§é‡ç»„ä»¶åŠå…ƒç´ æ—¶ï¼Œå¦‚ä½•æœ‰æ•ˆåœ°æ›´æ–°DOMï¼Œä½¿é¡µé¢æ¸²æŸ“æ€§èƒ½æœ€ä¼˜åŒ–ã€‚</p><p>å…·ä½“åœ°ï¼Œåè°ƒç®—æ³•è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li><strong>ç¡®å®šå“ªäº›ç»„ä»¶å’ŒDOMå…ƒç´ éœ€è¦æ›´æ–°</strong>: å½“çŠ¶æ€æˆ–è€…å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReactéœ€è¦ç¡®å®šå“ªäº›ç»„ä»¶å’Œå…ƒç´ éœ€è¦é‡æ–°æ¸²æŸ“ã€‚åè°ƒç®—æ³•é€šè¿‡æ¯”è¾ƒæ–°æ—§è™šæ‹ŸDOMæ ‘ï¼Œå¿«é€Ÿæ‰¾å‡ºéœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“æ“ä½œã€‚</li><li><strong>æœ€å°åŒ–DOMæ“ä½œæ•°é‡</strong>: ç›´æ¥æ“ä½œDOMæ˜¯æ˜‚è´µçš„ï¼Œå› æ­¤Reactå°½åŠ›å‡å°‘å®é™…DOMæ“ä½œçš„æ•°é‡ã€‚åè°ƒç®—æ³•é€šè¿‡åªå˜æ›´å·®å¼‚éƒ¨åˆ†çš„æ–¹æ³•ï¼Œç¡®ä¿äº†åªåœ¨å¿…é¡»çš„åœ°æ–¹è¿›è¡ŒDOMæ“ä½œã€‚</li><li><strong>æŒç»­æ€§èƒ½ä¼˜åŒ–</strong>: åè°ƒç®—æ³•åœ¨ä¸æ–­ä¼˜åŒ–è¿‡ç¨‹ä¸­æå‡æ€§èƒ½ï¼Œåº”ç”¨çš„è§„æ¨¡å¹¶ä¸ä¼šå¯¹Reactåº”ç”¨çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</li><li><strong>æä¾›ç¨³å®šçš„ç»„ä»¶_id_å’Œ_key_</strong>: åœ¨åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šå‡ºç°å¤§é‡ç›¸ä¼¼æˆ–ç›¸åŒç±»å‹çš„å…ƒç´ åˆ—è¡¨ï¼Œå¦‚ä½•å¿«é€Ÿå‡†ç¡®åœ°è¯†åˆ«å®ƒä»¬å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚é€šè¿‡Reactæä¾›çš„keyå±æ€§ï¼Œåè°ƒç®—æ³•èƒ½å¤Ÿæ›´å¥½åœ°è¿½è¸ªå“ªäº›å…ƒç´ å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œå‡å°‘é‡ç»˜å’Œé‡æ’ï¼Œæå‡æ¸²æŸ“æ€§èƒ½ã€‚</li></ul><h2 id="å­¦ä¹ åšå®¢" tabindex="-1"><a class="header-anchor" href="#å­¦ä¹ åšå®¢"><span>å­¦ä¹ åšå®¢</span></a></h2><p><a href="https://react.iamkasong.com/process/fiber.html#fiber%E7%9A%84%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">ReactæŠ€æœ¯æ­ç§˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="external-link label" href="https://github.com/Christine-Only/blog/edit/master/docs/react/advance.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--[--><svg class="icon" viewBox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link route-link-active prev" href="/blog/react/" aria-label="React åŸºç¡€"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>React åŸºç¡€</span></div><!--]--></a><a class="route-link next" href="/blog/react/hooks.html" aria-label="React Hooks"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>React Hooks</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-C8Xn24jF.js" defer></script>
  </body>
</html>
